<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAI - HeyGen Avatar Demo</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Styles -->
    <style>
        /* Main container styles */
        .avatar-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            aspect-ratio: 16/9;
            background-color: #f0f0f0;
            border-radius: 8px;
            overflow: hidden;
        }

        /* HeyGen Avatar Styles */
        #heygen-streaming-embed {
            z-index: 9999;
            position: fixed;
            left: 40px;
            bottom: 40px;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0px 8px 24px 0px rgba(0, 0, 0, 0.12);
            transition: all linear 0.1s;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
        }

        #heygen-streaming-embed.show {
            opacity: 1;
            visibility: visible;
        }

        #heygen-streaming-container {
            width: 100%;
            height: 100%;
        }

        #heygen-streaming-container iframe {
            width: 100%;
            height: 100%;
            border: 0;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen">
    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8">Interactive RAI Avatar Demo</h1>
        
        <!-- Instructions Card -->
        <div class="max-w-3xl mx-auto bg-white rounded-lg shadow-lg p-6">
            <div class="mb-8 text-center">
                <p class="text-gray-600">This demo showcases an interactive AI avatar.</p>
            </div>
            
            <div class="space-y-4">
                <div class="flex flex-col">
                    <label class="text-lg font-medium text-gray-700 mb-2">Instructions:</label>
                    <ol class="list-decimal list-inside space-y-2 text-gray-600">
                        <li>Wait for the avatar to appear in the bottom-left corner</li>
                        <li>Click on the avatar to expand it</li>
                        <li>Interact with the avatar through text or voice</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- HeyGen Avatar Integration Script -->
    <script>
        (function(window) {
            // Configuration
            const host = "https://labs.heygen.com";
            const avatarConfig = {
                quality: "high",
                avatarName: "Ann_Therapist_public",
                knowledgeBaseId: "b08f15208b214718a4c6d0fdd918c21",
                username: "6179b791b92741bf83d6a21736c3676b"
            };

            // Create embed URL
            const url = `${host}/guest/streaming-embed?share=eyJxdWFsaXR5IjoiaGlnaCIsImF2YXRhck5hbWUiOiJBbm5fVGhlcmFwaXN0X3B1YmxpYyIsInBy%0D%0AZXZpZXdJbWciOiJodHRwczovL2ZpbGVzMi5oZXlnZW4uYWkvYXZhdGFyL3YzLzc1ZTBhODdiN2Zk%0D%0AOTRmMDk4MWZmMzk4YjU5M2RkNDdmXzQ1NTcwL3ByZXZpZXdfdGFsa180LndlYnAiLCJuZWVkUmVt%0D%0Ab3ZlQmFja2dyb3VuZCI6ZmFsc2UsImtub3dsZWRnZUJhc2VJZCI6ImIwOGYxNTIwOGIyMTQ3MWM4%0D%0AYTRjNmQwZmRkOTE4YzIxIiwidXNlcm5hbWUiOiI2MTc5Yjc5MWI5Mjc0MWJmODNkNmEyMTczNmMz%0D%0ANjc2YiJ9&inIFrame=1`;
            
            // Create container elements
            const clientWidth = document.body.clientWidth;
            const wrapDiv = document.createElement("div");
            wrapDiv.id = "heygen-streaming-embed";
            
            const container = document.createElement("div");
            container.id = "heygen-streaming-container";

            // Create responsive styles
            const expandedStyle = clientWidth < 540 
                ? "height: 266px; width: 96%; left: 50%; transform: translateX(-50%);"
                : "height: 366px; width: calc(366px * 16 / 9);";

            // Add dynamic style for expanded state
            const expandedStyleSheet = document.createElement("style");
            expandedStyleSheet.textContent = `
                #heygen-streaming-embed.expand {
                    ${expandedStyle}
                    border: 0;
                    border-radius: 8px;
                }
            `;
            document.head.appendChild(expandedStyleSheet);

            // Create and configure iframe
            const iframe = document.createElement("iframe");
            iframe.allowFullscreen = false;
            iframe.title = "Streaming Embed";
            iframe.role = "dialog";
            iframe.allow = "microphone";
            iframe.src = url;

            // State management
            let visible = false;
            let initial = false;

            // Handle messages from iframe
            window.addEventListener("message", (event) => {
                if (event.origin !== host) return;
                if (!event.data || !event.data.type || event.data.type !== "streaming-embed") return;

                switch (event.data.action) {
                    case "init":
                        initial = true;
                        wrapDiv.classList.toggle("show", initial);
                        break;
                    case "show":
                        visible = true;
                        wrapDiv.classList.toggle("expand", visible);
                        break;
                    case "hide":
                        visible = false;
                        wrapDiv.classList.toggle("expand", visible);
                        break;
                }
            });

            // Assemble and append elements
            container.appendChild(iframe);
            wrapDiv.appendChild(container);
            document.body.appendChild(wrapDiv);

        })(globalThis);
    </script>
</body>
</html>
