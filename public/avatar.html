<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bedtime - Journaling</title>
    
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#6B4E71">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Raigen3">
    <link rel="apple-touch-icon" href="/images/icon-192x192.png">
    <meta name="description" content="Interactive RAI Avatar - Your AI Therapist">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/icon-192x192.png">
    <link href="/css/output.css" rel="stylesheet">
    
    <!-- HeyGen Avatar Styles -->
    <style>
        #heygen-streaming-embed {
            z-index: 9999;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 80vw;
            max-width: 1200px;
            height: 80vh;
            border-radius: 12px;
            border: 2px solid #6B4E71;
            box-shadow: 0px 8px 24px 0px rgba(0, 0, 0, 0.2);
            transition: all ease-in-out 0.3s;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        #heygen-streaming-embed.show {
            opacity: 1;
            visibility: visible;
        }

        #heygen-streaming-container {
            width: 100%;
            height: 100%;
        }

        #heygen-streaming-container iframe {
            width: 100%;
            height: 100%;
            border: 0;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center bg-meditation bg-cover bg-center bg-no-repeat text-text antialiased p-5">
    <a href="/" class="fixed top-4 left-4 z-50 flex items-center gap-2 px-4 py-2 bg-primary/90 hover:bg-accent text-white rounded-lg shadow-lg transition-all duration-300 border border-white/20">
        <span>üè†</span>
        <span>Home</span>
    </a>
    <!-- Main Content -->
    <div class="container-glass text-center p-8 max-w-4xl w-11/12 mb-8">
        <h1 class="text-4xl font-bold mb-8 text-text">Bedtime - Journaling</h1>
        
        <!-- Instructions Card -->
        <div class="bg-container/50 backdrop-blur-sm rounded-xl shadow-lg p-6 mt-8">
            <div class="mb-8 text-center">
                <p class="text-lg text-text">This demo showcases an interactive journaling with AI avatar in many languages</p>
            </div>
            
            <div class="space-y-4">
                <div class="flex flex-col">
                    <label class="text-xl font-bold text-text mb-4">Instructions:</label>
                    <ol class="list-decimal list-inside space-y-3 text-text">
                        <li>Wait for the avatar to appear in the bottom-left corner</li>
                        <li>Click on the avatar to expand it</li>
                        <li>Interact with the avatar through text or voice</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- HeyGen Avatar Integration Script -->
    <script>
        (function(window) {
            // Configuration
            const host = "https://labs.heygen.com";
            const avatarConfig = {
                quality: "high",
                avatarName: "Ann_Therapist_public",
                knowledgeBaseId: "b08f15208b214718a4c6d0fdd918c21",
                username: "6179b791b92741bf83d6a21736c3676b"
            };

            // Create embed URL
            const url = `${host}/guest/streaming-embed?share=eyJxdWFsaXR5IjoiaGlnaCIsImF2YXRhck5hbWUiOiJBbm5fVGhlcmFwaXN0X3B1YmxpYyIsInBy%0D%0AZXZpZXdJbWciOiJodHRwczovL2ZpbGVzMi5oZXlnZW4uYWkvYXZhdGFyL3YzLzc1ZTBhODdiN2Zk%0D%0AOTRmMDk4MWZmMzk4YjU5M2RkNDdmXzQ1NTcwL3ByZXZpZXdfdGFsa180LndlYnAiLCJuZWVkUmVt%0D%0Ab3ZlQmFja2dyb3VuZCI6ZmFsc2UsImtub3dsZWRnZUJhc2VJZCI6ImIwOGYxNTIwOGIyMTQ3MWM4%0D%0AYTRjNmQwZmRkOTE4YzIxIiwidXNlcm5hbWUiOiI2MTc5Yjc5MWI5Mjc0MWJmODNkNmEyMTczNmMz%0D%0ANjc2YiJ9&inIFrame=1`;
            
            // Create container elements
            const clientWidth = document.body.clientWidth;
            const wrapDiv = document.createElement("div");
            wrapDiv.id = "heygen-streaming-embed";
            
            const container = document.createElement("div");
            container.id = "heygen-streaming-container";

            // Avatar is already maximized by default, no need for expanded styles
            const expandedStyleSheet = document.createElement("style");
            expandedStyleSheet.textContent = `
                #heygen-streaming-embed.expand {
                    opacity: 1;
                    visibility: visible;
                }
            `;
            document.head.appendChild(expandedStyleSheet);

            // Create and configure iframe
            const iframe = document.createElement("iframe");
            iframe.allowFullscreen = false;
            iframe.title = "Streaming Embed";
            iframe.role = "dialog";
            iframe.allow = "microphone";
            iframe.src = url;

            // State management
            let visible = false;
            let initial = false;

            // Handle messages from iframe
            window.addEventListener("message", (event) => {
                if (event.origin !== host) return;
                if (!event.data || !event.data.type || event.data.type !== "streaming-embed") return;

                switch (event.data.action) {
                    case "init":
                        initial = true;
                        wrapDiv.classList.add("show");
                        wrapDiv.classList.add("expand");
                        break;
                    case "show":
                        visible = true;
                        wrapDiv.classList.toggle("expand", visible);
                        break;
                    case "hide":
                        visible = false;
                        wrapDiv.classList.toggle("expand", visible);
                        break;
                }
            });

            // Assemble and append elements
            container.appendChild(iframe);
            wrapDiv.appendChild(container);
            document.body.appendChild(wrapDiv);

        })(globalThis);
    </script>
</body>
</html>
